# 何をやったらいいの？

課題挑戦時(2022/3)における理解をまとめました。  
未提出なので間違いあるかもしれません。  


## 何をやったらいいの？

- リダイレクトでファイルから入力を読み取る  
- コマンドを実行してパイプで次に流す…を繰り返す  
- リダイレクトで実行結果をファイルに出力する  

こういう処理を実装すればよいです。  


## 具体的に考える前に…

### プロセスとストリーム

具体的に考える前に、プロセスとストリームについて整理しておきます。  

※ 雑説明なので注意！  

プログラムが実行され、実体化されたものを`プロセス`といいます。  
`プロセス`の処理になんらかのデータが必要なら、`入力元`から受け取ります。  
`プロセス`の処理の結果を出力する必要があるなら、`出力先`に出力します。  
`プロセス`と、プロセスに繋げた`入力元`や`出力先`とのデータの流れを`ストリーム`といいます。  

`入力元`や`出力先`は抽象化され、ファイル（データのかたまり）として扱われます。  
例えば、`入力元`には キーボードからの入力 や ファイルからの読み込み など、いろいろありますが、入力されたデータをファイル（データのかたまり）扱いすると、入力デバイスが何であろうが同じように扱えて都合が良いのです。`出力先`も同様です。  
データの流れと考えられるものはどんなものでも`ストリーム`として扱えます。  

`入力元`はデフォルトでは 標準入力（ターミナルからの入力）、`出力先`はデフォルトでは 標準出力（ターミナル）とされていますが、`リダイレクト`を使うことで変更することができます。  
例１：  
ターミナルで`echo abc`とコマンドを実行すると、`abc`は標準出力に出力されます。  
ターミナルで`echo abc > abc.txt`とコマンドを実行すると、`abc`は`abc.txt`というファイルに出力されます。  
`リダイレクト ">"`で`出力先`が標準出力からファイルに変更されました。  

`プロセス`の`出力先`と`プロセス`の`入力元`を繋げることによって、プロセス同士のデータのやり取りもできます。  
例２：  
ターミナルで`echo abc def`とコマンドを実行すると、`abc def`は標準出力に出力されます。  
ターミナルで`echo abc def | wc -w`とコマンドを実行すると、`abc def`は 標準出力 ではなく次の`wc -w`コマンドの 標準入力 に渡され、実行結果である`2`を 標準出力 に出力します。  
`パイプ "|"`で`出力先`が 標準出力から次のコマンドの標準入力に変更されました。  

`パイプ`は名前通り管で、`ストリーム`を通すことができます。これをうまく繋げることでデータの流れをコントロールすることができます。  

余談ですが、コンピュータ内部でのプロセス同士のやりとり を ネットワークを介したプロセス同士のやり取り に変えたものが ネットワーク通信 となります。  

### ファイルディスクリプター

ファイルディスクリプターについても少々。  

※ 雑説明なので注意！

`入力元`や`出力先`は抽象化され、ファイル（データのかたまり）として扱われますが、それにアクセスするためにファイルディスクリプターが必要になります。  
ファイルディスクリプターは、ファイル（データのかたまり）とプロセスをマッピングするものと考えてください。  
具体的にファイル`aaa.txt`を開く場合で考えてみます。  
システムコール`open()`で`aaa.txt`を開くと、`ファイルテーブル`に`aaa.txt`用の項目が作成されます。項目は`aaa.txt`のディスクにおける位置など、マッピングのためのデータを格納しています。そして戻り値として項目の識別番号（ファイルディスクリプター）が返します。
ですから、識別番号さえ分かっていれば、`aaa.txt`の項目にアクセスでき、そしてそこには`aaa.txt`のデータが格納されているので、`aaa.txt`にアクセスすることができます。  
システムコール`close()`で`aaa.txt`の識別番号を閉じると、`aaa.txt`の項目が削除され、識別番号は未使用の状態に戻ります。  


## それを踏まえて、具体的に何をやったらいいの…？

1. 入力元のファイル(infile)を開き、それを最初のコマンドの入力元に繋ぎます。  
2. コマンドの実行結果の出力先を次のコマンドの入力元に繋ぎ、コマンドを実行します。  
3. 2.を繰り返します。最後のコマンドの場合は 4.へ。  
4. 出力先のファイル(outfile)を開き、それを最後のコマンドの出力先に繋ぎ、コマンドを実行します。  
こんな感じで実装していけばいいです。  


## どうやって実装していくの？

具体例を見ながらでないと理解しにくいので、別記事書きました。  

pipexに取り組む前に… チュートリアル  
[tutorial](./tutorial.md)  

